name: Test Opera Proxy

on:
  workflow_dispatch:

jobs:
  run-opera-proxy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Download opera-proxy
        run: |
          wget https://github.com/Snawoot/opera-proxy/releases/download/v1.13.1/opera-proxy.linux-amd64 -O opera-proxy
          chmod +x opera-proxy

      - name: List available countries
        run: |
          ./opera-proxy -list-countries

      - name: Start opera-proxy in background
        run: |
          nohup ./opera-proxy -country US > opera.log 2>&1 &
          sleep 5
          echo "Proxy started"

      - name: Show opera-proxy logs
        run: |
          cat opera.log

      - name: Test proxy with curl
        run: |
          echo "Testing proxy..."
          curl --proxy http://127.0.0.1:18080 https://api.ipify.org?format=json
